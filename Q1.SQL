CREATE SEQUENCE SQ_CLIENT_DATA_ID;

CREATE TABLE CLIENT_DATA
(
CLIENT_ID NUMBER DEFAULT SQ_CLIENT_DATA_ID.NEXTVAL, 
FIRSTNAME VARCHAR2(100) NOT NULL,
MIDDLENAME VARCHAR2(100) ,
LASTNAME VARCHAR2(100) NOT NULL,
DATEOFBIRTH DATE NOT NULL,
CC_ID NUMBER NOT NULL ,
CC_EXPIRE_DATE DATE NOT NULL,
VALID SMALLINT NOT NULL CHECK (VALID IN (0,1)),
INPUTDATE DATE DEFAULT SYSDATE,
INPUTUSER VARCHAR2(100) DEFAULT USER,
LASTMAINTDATE DATE,
LASTMAINTUSER VARCHAR2(100),


CONSTRAINT UNIQUE_CLIENT_DATA PRIMARY KEY (CLIENT_ID),

CONSTRAINT UNIQUE_CLIENT_CC_ID UNIQUE (CC_ID)
)
;

CREATE SEQUENCE SQ_ACCOUNT_DATA_ID;

CREATE TABLE ACCOUNT_DATA
(
ACCOUNT_ID NUMBER(20) DEFAULT SQ_ACCOUNT_DATA_ID.NEXTVAL ,
CLIENT_ID NUMBER(20) NOT NULL,
ACC_TYPE VARCHAR2(100) NOT NULL CHECK (ACC_TYPE IN ('Current', 'Future', 'Pay-Check')),
DESCRIPTION VARCHAR2(2000) NOT NULL,
STARTDATE DATE NOT NULL,
ENDDATE DATE ,
COMMENTS VARCHAR2(2000),
VALID SMALLINT NOT NULL CHECK (VALID IN (1,0)) DEFAULT 0,
INPUTDATE DATE DEFAULT SYSDATE,
INPUTUSER VARCHAR2(100) DEFAULT USER,
LASTMAINTDATE DATE,
LASTMAINTUSER VARCHAR2(100),


CONSTRAINT UNIQUE_ACCOUNT_DATA PRIMARY KEY (ACCOUNT_ID),

CONSTRAINT UNIQUE_TP_ACCOUNT_CLIENT  UNIQUE (CLIENT_ID, ACC_TYPE),

CONSTRAINT FK_CLIENT_ID
    FOREIGN KEY (CLIENT_ID)
    REFERENCES CLIENT_DATA (CLIENT_ID),
	

);


ALTER TABLE ACCOUNT_DATA  ADD CONSTRAINT CK_END_DATE CHECK (EndDate  > StartDate );


CREATE SEQUENCE SQ_MOVEMENTS_ID;

	CREATE TABLE MOVEMENTS
	(
	MOV_ID NUMBER(20),
	ACCOUNT_ID NUMBER(20),
	"DATE" DATE,
	MOV_TYPE VARCHAR2(100) CHECK  (MOV_TYPE IN ('D','C')),
	MOV_TYPE_DESC VARCHAR2(2000) ,
	AMOUNT NUMBER(10,2),
	CURRENCY VARCHAR2(2000),
	DESCRIPTION VARCHAR2(2000),
	SEND_DATE TIMESTAMP NOT NULL ,
	INPUTDATE DATE DEFAULT SYSDATE,
	INPUTUSER VARCHAR2(100) DEFAULT USER,
	LASTMAINTDATE DATE NOT NULL,
	LASTMAINTUSER VARCHAR2(100) NOT NULL ,


	CONSTRAINT FK_ACCOUNT_ID
		FOREIGN KEY (ACCOUNT_ID)
		REFERENCES ACCOUNT_DATA (ACCOUNT_ID)
	);

CREATE SEQUENCE SQ_LOG_VALIDATION;

CREATE TABLE LOG_VALIDATION 
(LOG_ID NUMBER(20) DEFAULT SQ_LOG_VALIDATION.NEXTVAL, 	
CLIENT_ID NUMBER,
CONTA_ID NUMBER,
MESSAGE VARCHAR2(2000), 
INPUTDATE DATE DEFAULT SYSDATE,
INPUTUSER VARCHAR2(2000) DEFAULT USER,

CONSTRAINT UNIQUE_LOG_VALIDATION PRIMARY KEY (LOG_ID),

	CONSTRAINT FK_LOG_CLIENT_ID
		FOREIGN KEY (CLIENT_ID)
		REFERENCES CLIENT_DATA (CLIENT_ID),
		
	CONSTRAINT FK_LOG_ACCOUNT_ID
		FOREIGN KEY (CONTA_ID)
		REFERENCES ACCOUNT_DATA (ACCOUNT_ID)
		
 );
 
 